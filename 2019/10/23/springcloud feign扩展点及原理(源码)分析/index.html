<!DOCTYPE html>
<html lang=zh>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <meta name="google-site-verification" content="29vLVh4vA4suQh5SRMCfQisJ8UugXBkjM46VFkYeonU">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000">
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top">

  <!--  -->

  
  <title>spring cloud feign扩展点及原理(源码)分析 | Hexo</title>
  <meta name="description" content="[toc] 背景 远程调用实现技术方案中, spring cloud openfeign可以说是入门简单，使用方便。作为spring cloud家族成员，它的使用量广泛。了解spring framework, spring boot, spring cloud本身就是一件技术人分内的事。进阶路上，这是必须做的。     debug源码，直观收益是学习标准的代码风格，编码思想，实现方法和技巧，从而提">
<meta property="og:type" content="article">
<meta property="og:title" content="spring cloud feign扩展点及原理(源码)分析">
<meta property="og:url" content="https://yaoyuanyy.github.io/2019/10/23/springcloud feign扩展点及原理(源码)分析/index.html">
<meta property="og:site_name" content="skyler-blog">
<meta property="og:description" content="[toc] 背景 远程调用实现技术方案中, spring cloud openfeign可以说是入门简单，使用方便。作为spring cloud家族成员，它的使用量广泛。了解spring framework, spring boot, spring cloud本身就是一件技术人分内的事。进阶路上，这是必须做的。     debug源码，直观收益是学习标准的代码风格，编码思想，实现方法和技巧，从而提">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191109101703.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191102190916.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191105185059.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191106171742.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191107074325.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191107080016.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191107081652.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191107081722.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191107081510.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/!%5B20191107084916.png%5D(httpsraw.githubusercontent.comyaoyuanyyMarkdownPhotosmasterimg20191107084916.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191107085102.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191107090336.png">
<meta property="og:image" content="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191108073006.png">
<meta property="og:updated_time" content="2025-11-01T13:38:35.634Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="spring cloud feign扩展点及原理(源码)分析">
<meta name="twitter:description" content="[toc] 背景 远程调用实现技术方案中, spring cloud openfeign可以说是入门简单，使用方便。作为spring cloud家族成员，它的使用量广泛。了解spring framework, spring boot, spring cloud本身就是一件技术人分内的事。进阶路上，这是必须做的。     debug源码，直观收益是学习标准的代码风格，编码思想，实现方法和技巧，从而提">
<meta name="twitter:image" content="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191109101703.png">
  <!-- Canonical links -->
  <link rel="canonical" href="https://yaoyuanyy.github.io/2019/10/23/springcloud feign扩展点及原理(源码)分析/index.html">
  
    <link rel="alternate" href="/atom.xml" title="skyler-blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  <link rel="stylesheet" href="/css/style.css">
  
  
  
  
</head>


<body class="main-center" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope="" itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/yaoyuanyy" target="_blank">
          <img class="img-circle img-rotate" src="/images/meinv.jpeg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">skyler</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">Web Developer</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> beijing, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索">
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech="">
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope="" itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav ">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">标签</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">项目</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-books">
          <a href="/books">
            
            <i class="icon icon-book-fill"></i>
            
            <span class="menu-title">书单</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">友链</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">关于</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/yaoyuanyy" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li>
        
        <li><a href="https://juejin.cn/user/729731449759047/posts" target="_blank" title="Juejin" data-toggle="tooltip" data-placement="top"><i class="icon icon-juejin"></i></a></li>
        
        <li><a href="https://blog.csdn.net/mingliangniwo" target="_blank" title="Csdn" data-toggle="tooltip" data-placement="top"><i class="icon icon-csdn"></i></a></li>
        
        <li><a href="https://yaoyuanyy.github.io" target="_blank" title="Github Pages" data-toggle="tooltip" data-placement="top"><i class="icon icon-github pages"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope="" itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>欢迎交流与分享经验!</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AI/">AI</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/docker/centos7/">centos7</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/centos8/">centos8</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/http/">http</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/http/javaweb/">javaweb</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">14</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/agent/">agent</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/jvm/">jvm</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/spring/">spring</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/java-io/">java io</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java基础/">java基础</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java多线程/">java多线程</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java程序员/">java程序员</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java经典/">java经典</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java网络/">java网络</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/juc/">juc</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/jvm虚拟机/">jvm虚拟机</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/jvm虚拟机/springboot/">springboot</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mac开发工具/">mac开发工具</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/spring/">spring</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/springboot/">springboot</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/博客/">博客</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/命令/">命令</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/婚姻/">婚姻</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/开发工具/">开发工具</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/开发效率工具/">开发效率工具</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/微服务/">微服务</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/思考/">思考</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/教育/">教育</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/life/">生活</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/男性/">男性</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/考试/">考试</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/股市/">股市</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/股票/">股票</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机组成/">计算机组成</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/认知/">认知</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/认知/读书/">读书</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/读书/">读书</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维/">运维</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/面试/">面试</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/高质量文章/">高质量文章</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签</h3>
    <div class="widget-body">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/">$</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/符号/">$符号</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/2的次方/">2的次方</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AI提示词/">AI提示词</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AQS/">AQS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cache/">Cache</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RAM内存/">RAM内存</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ReentrantLock/">ReentrantLock</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ThreadPoolExecutor/">ThreadPoolExecutor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Value/">\@Value</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/alfred/">alfred</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apollo-client/">apollo-client</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos7/">centos7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos8/">centos8</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/classloader/">classloader</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cursor/">cursor</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deepseek/">deepseek</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/futex/">futex</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git-revert/">git revert</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/https/">https</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iTerm2/">iTerm2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/interactive-timeout/">interactive_timeout</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/interview/">interview</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/io读写/">io读写</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java-命令/">java 命令</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javaagent/">javaagent</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java多线程/">java多线程</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java并发/">java并发</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java微服务调用/">java微服务调用</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java技术栈/">java技术栈</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java探针/">java探针</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java类加载/">java类加载</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java线程池/">java线程池</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java网络/">java网络</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/juc/">juc</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jvm/">jvm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jvm虚拟机/">jvm虚拟机</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux网络命令/">linux网络命令</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lsof/">lsof</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mac/">mac</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mac网络命令/">mac网络命令</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql网络/">mysql网络</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/netstat/">netstat</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/prompt/">prompt</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ranger/">ranger</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/">spring</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring-aop/">spring aop</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring-boot/">spring boot</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring-cloud微服务调用/">spring cloud微服务调用</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring-transaction/">spring transaction</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springboot/">springboot</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springboot-jar包可运行/">springboot jar包可运行</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springboot-loader/">springboot loader</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springboot加载/">springboot加载</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springcloud/">springcloud</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tcpip/">tcpip</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tmux/">tmux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wait-timeout/">wait_timeout</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/书籍会说话/">书籍会说话</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/健康/">健康</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/加密/">加密</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/命令行下载视频/">命令行下载视频</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/大牛技术/">大牛技术</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/婚姻/">婚姻</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/开发效率工具/">开发效率工具</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/得失感悟/">得失感悟</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/思考/">思考</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/找工作/">找工作</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/技术文章/">技术文章</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/投资/">投资</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/拦截器/">拦截器</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/教育/">教育</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数字签名/">数字签名</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数字证书/">数字证书</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/生活感悟/">生活感悟</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/男性/">男性</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/神器/">神器</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/策略模式/">策略模式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/类加载/">类加载</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/考试/">考试</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/股市/">股市</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/读书/">读书</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/读取文件/">读取文件</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/读取日志文件/">读取日志文件</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/随机写/">随机写</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面试/">面试</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/顺序写/">顺序写</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签云</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/" style="font-size: 13px;">$</a> <a href="/tags/符号/" style="font-size: 13px;">$符号</a> <a href="/tags/2的次方/" style="font-size: 13px;">2的次方</a> <a href="/tags/AI提示词/" style="font-size: 13px;">AI提示词</a> <a href="/tags/AQS/" style="font-size: 13px;">AQS</a> <a href="/tags/Cache/" style="font-size: 13px;">Cache</a> <a href="/tags/RAM内存/" style="font-size: 13px;">RAM内存</a> <a href="/tags/ReentrantLock/" style="font-size: 13px;">ReentrantLock</a> <a href="/tags/ThreadPoolExecutor/" style="font-size: 13px;">ThreadPoolExecutor</a> <a href="/tags/Value/" style="font-size: 13px;">\@Value</a> <a href="/tags/alfred/" style="font-size: 13px;">alfred</a> <a href="/tags/apollo-client/" style="font-size: 13px;">apollo-client</a> <a href="/tags/centos7/" style="font-size: 13px;">centos7</a> <a href="/tags/centos8/" style="font-size: 13.25px;">centos8</a> <a href="/tags/classloader/" style="font-size: 13px;">classloader</a> <a href="/tags/cursor/" style="font-size: 13.13px;">cursor</a> <a href="/tags/deepseek/" style="font-size: 13px;">deepseek</a> <a href="/tags/docker/" style="font-size: 13.5px;">docker</a> <a href="/tags/futex/" style="font-size: 13px;">futex</a> <a href="/tags/git/" style="font-size: 13px;">git</a> <a href="/tags/git-revert/" style="font-size: 13px;">git revert</a> <a href="/tags/github/" style="font-size: 13.25px;">github</a> <a href="/tags/hexo/" style="font-size: 13px;">hexo</a> <a href="/tags/http/" style="font-size: 13.13px;">http</a> <a href="/tags/https/" style="font-size: 13.13px;">https</a> <a href="/tags/iTerm2/" style="font-size: 13px;">iTerm2</a> <a href="/tags/interactive-timeout/" style="font-size: 13px;">interactive_timeout</a> <a href="/tags/interview/" style="font-size: 13px;">interview</a> <a href="/tags/io读写/" style="font-size: 13px;">io读写</a> <a href="/tags/java/" style="font-size: 13.75px;">java</a> <a href="/tags/java-命令/" style="font-size: 13px;">java 命令</a> <a href="/tags/javaagent/" style="font-size: 13.25px;">javaagent</a> <a href="/tags/java多线程/" style="font-size: 13.13px;">java多线程</a> <a href="/tags/java并发/" style="font-size: 13px;">java并发</a> <a href="/tags/java微服务调用/" style="font-size: 13px;">java微服务调用</a> <a href="/tags/java技术栈/" style="font-size: 13px;">java技术栈</a> <a href="/tags/java探针/" style="font-size: 13px;">java探针</a> <a href="/tags/java类加载/" style="font-size: 13px;">java类加载</a> <a href="/tags/java线程池/" style="font-size: 13px;">java线程池</a> <a href="/tags/java网络/" style="font-size: 13.13px;">java网络</a> <a href="/tags/juc/" style="font-size: 13px;">juc</a> <a href="/tags/jvm/" style="font-size: 13px;">jvm</a> <a href="/tags/jvm虚拟机/" style="font-size: 13px;">jvm虚拟机</a> <a href="/tags/linux/" style="font-size: 13.5px;">linux</a> <a href="/tags/linux网络命令/" style="font-size: 13.25px;">linux网络命令</a> <a href="/tags/lsof/" style="font-size: 13px;">lsof</a> <a href="/tags/mac/" style="font-size: 13.38px;">mac</a> <a href="/tags/mac网络命令/" style="font-size: 13.13px;">mac网络命令</a> <a href="/tags/mysql/" style="font-size: 13.38px;">mysql</a> <a href="/tags/mysql网络/" style="font-size: 13px;">mysql网络</a> <a href="/tags/netstat/" style="font-size: 13px;">netstat</a> <a href="/tags/prompt/" style="font-size: 13.25px;">prompt</a> <a href="/tags/ranger/" style="font-size: 13px;">ranger</a> <a href="/tags/spring/" style="font-size: 14px;">spring</a> <a href="/tags/spring-aop/" style="font-size: 13.25px;">spring aop</a> <a href="/tags/spring-boot/" style="font-size: 13.63px;">spring boot</a> <a href="/tags/spring-cloud微服务调用/" style="font-size: 13px;">spring cloud微服务调用</a> <a href="/tags/spring-transaction/" style="font-size: 13.13px;">spring transaction</a> <a href="/tags/springboot/" style="font-size: 13.88px;">springboot</a> <a href="/tags/springboot-jar包可运行/" style="font-size: 13px;">springboot jar包可运行</a> <a href="/tags/springboot-loader/" style="font-size: 13px;">springboot loader</a> <a href="/tags/springboot加载/" style="font-size: 13px;">springboot加载</a> <a href="/tags/springcloud/" style="font-size: 13.25px;">springcloud</a> <a href="/tags/tcpip/" style="font-size: 13.13px;">tcpip</a> <a href="/tags/tmux/" style="font-size: 13px;">tmux</a> <a href="/tags/wait-timeout/" style="font-size: 13px;">wait_timeout</a> <a href="/tags/书籍会说话/" style="font-size: 13px;">书籍会说话</a> <a href="/tags/健康/" style="font-size: 13px;">健康</a> <a href="/tags/加密/" style="font-size: 13.13px;">加密</a> <a href="/tags/命令行下载视频/" style="font-size: 13px;">命令行下载视频</a> <a href="/tags/大牛技术/" style="font-size: 13px;">大牛技术</a> <a href="/tags/婚姻/" style="font-size: 13px;">婚姻</a> <a href="/tags/开发效率工具/" style="font-size: 13.13px;">开发效率工具</a> <a href="/tags/得失感悟/" style="font-size: 13px;">得失感悟</a> <a href="/tags/思考/" style="font-size: 13px;">思考</a> <a href="/tags/找工作/" style="font-size: 13px;">找工作</a> <a href="/tags/技术文章/" style="font-size: 13px;">技术文章</a> <a href="/tags/投资/" style="font-size: 13.25px;">投资</a> <a href="/tags/拦截器/" style="font-size: 13px;">拦截器</a> <a href="/tags/教育/" style="font-size: 13px;">教育</a> <a href="/tags/数字签名/" style="font-size: 13.13px;">数字签名</a> <a href="/tags/数字证书/" style="font-size: 13.13px;">数字证书</a> <a href="/tags/生活感悟/" style="font-size: 13px;">生活感悟</a> <a href="/tags/男性/" style="font-size: 13px;">男性</a> <a href="/tags/神器/" style="font-size: 13px;">神器</a> <a href="/tags/策略模式/" style="font-size: 13px;">策略模式</a> <a href="/tags/类加载/" style="font-size: 13.13px;">类加载</a> <a href="/tags/考试/" style="font-size: 13.25px;">考试</a> <a href="/tags/股市/" style="font-size: 13.13px;">股市</a> <a href="/tags/读书/" style="font-size: 13.88px;">读书</a> <a href="/tags/读取文件/" style="font-size: 13px;">读取文件</a> <a href="/tags/读取日志文件/" style="font-size: 13px;">读取日志文件</a> <a href="/tags/随机写/" style="font-size: 13px;">随机写</a> <a href="/tags/面试/" style="font-size: 13px;">面试</a> <a href="/tags/顺序写/" style="font-size: 13px;">顺序写</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/10/">十月 2025</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/08/">八月 2025</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/07/">七月 2025</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/06/">六月 2025</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/05/">五月 2025</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/03/">三月 2025</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/01/">一月 2025</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">十一月 2024</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">八月 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">七月 2024</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">六月 2024</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">五月 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">四月 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">一月 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">十一月 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">三月 2023</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">二月 2023</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">十二月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">十一月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">六月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">五月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">四月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">二月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">一月 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">十一月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">七月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">二月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2025/10/11/穷人的特征/" class="title">穷人的特征</a>
              </p>
              <p class="item-date">
                <time datetime="2025-10-11T02:05:32.000Z" itemprop="datePublished">2025-10-11</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2025/10/11/如何培养一个优秀的小孩/" class="title">如何培养一个优秀的小孩</a>
              </p>
              <p class="item-date">
                <time datetime="2025-10-11T01:05:32.000Z" itemprop="datePublished">2025-10-11</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/考试/">考试</a>
              </p>
              <p class="item-title">
                <a href="/2025/10/09/考公记录-行测-1-言语理解/" class="title">言语理解</a>
              </p>
              <p class="item-date">
                <time datetime="2025-10-09T03:10:59.000Z" itemprop="datePublished">2025-10-09</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/考试/">考试</a>
              </p>
              <p class="item-title">
                <a href="/2025/10/09/考公记录-行测/" class="title">考试记录</a>
              </p>
              <p class="item-date">
                <time datetime="2025-10-09T03:10:59.000Z" itemprop="datePublished">2025-10-09</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/考试/">考试</a>
              </p>
              <p class="item-title">
                <a href="/2025/10/09/考公记录/" class="title">考试记录</a>
              </p>
              <p class="item-date">
                <time datetime="2025-10-09T03:10:59.000Z" itemprop="datePublished">2025-10-09</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<main class="main" role="main">
  <div class="content">
  <article id="post-springcloud feign扩展点及原理(源码)分析" class="article article-type-post" itemscope="" itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      spring cloud feign扩展点及原理(源码)分析
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2019/10/23/springcloud feign扩展点及原理(源码)分析/" class="article-date">
	  <time datetime="2019-10-23T09:34:23.000Z" itemprop="datePublished">2019-10-23</time>
	</a>
</span>
        
        

        
	<span class="article-read hidden-xs">
	    <i class="icon icon-eye-fill" aria-hidden="true"></i>
	    <span id="busuanzi_container_page_pv">
			<span id="busuanzi_value_page_pv">0</span>
		</span>
	</span>


        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2019/10/23/springcloud feign扩展点及原理(源码)分析/#comments" class="article-comment-link">评论</a></span>
        
	
		<span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 5.9k(字)</span>
	
	
		<span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 25(分)</span>
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <p>[toc]</p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><blockquote>
<p>远程调用实现技术方案中, spring cloud openfeign可以说是入门简单，使用方便。作为spring cloud家族成员，它的使用量广泛。了解spring framework, spring boot, spring cloud本身就是一件技术人分内的事。进阶路上，这是必须做的。</p>
</blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>debug源码，直观收益是学习标准的代码风格，编码思想，实现方法和技巧，从而提升自身的能力</p>
</blockquote>
</blockquote>
</blockquote>
<h2 id="收获"><a href="#收获" class="headerlink" title="收获"></a>收获</h2><p>本篇偏重阐述<code>feign</code>的实现原理，而对他的用法用一个示例简单展示。因为本篇让你收获的不仅仅是<code>feign</code>的用法，更重要的是通过<code>feign</code>的原理阐述，能提炼出为你我所用的知识点，为你自己实现@EnableXXX注解提供一些依据和片段，力争实现突破，生产出你自己的东西。</p>
<p>本篇的目标是1.说清<code>feign</code>组件的加载即解析，尤其是关键组件的原理源码阐述；2.当用户请求进来后，<code>feign</code>是如何将<code>feign</code>方法解析为<code>http request</code>请求信息的。3.此外，在这基础上，重点阐述<code>feign</code>整个过程给我们带来哪些价值：两方面<br>一、复用点<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 如何加载一个package下指定的class文件即生成BeanDefinition放入spring容器</span><br><span class="line">2. Class&lt;T&gt;类生成T的instance</span><br><span class="line">3. 如何获取spring中的BeanDefinition、Object</span><br></pre></td></tr></table></figure></p>
<p>二、扩展点<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 扩展RuquestInteceptor，实现Get方式接受body data</span><br><span class="line">2. 自定义@EnableFeignClients.defaultConfiguration的值</span><br><span class="line">3. 自定义@FeignClient.configuration的值</span><br><span class="line">4. properties.yml和@Configuration声明的feign组件的优先级</span><br><span class="line">5. 自定义@EnableXXX组件，解决其他的问题</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191109101703.png" alt="20191109101703.png"></p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>下面撸出最简单的feign使用案例。<code>分别定义一个启动类、controller、feign接口</code>。如下，将这个作为素材进行<code>feign源码分析</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">@EnableFeignClients(&quot;com.skyler.manager&quot;)</span><br><span class="line">@EnableDiscoveryClient</span><br><span class="line">public class SkylerApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(SkylerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/brand&quot;)</span><br><span class="line">public class BrandController &#123;</span><br><span class="line">    @Autowired private BrandFeignClient brandFeignClient;</span><br><span class="line"></span><br><span class="line">    @PostMapping(value = &quot;/create&quot;, produces = MediaType.APPLICATION_JSON_VALUE, consumes = MediaType.APPLICATION_JSON_VALUE)</span><br><span class="line">    public ResultVO create(@RequestBody BrandParam param) &#123;</span><br><span class="line">        return brandFeignClient.create(param);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@FeignClient(value = &quot;$&#123;provider.application:serverB&#125;&quot;, contextId = &quot;BrandFeignClient&quot;)</span><br><span class="line">public interface BrandFeignClient &#123;</span><br><span class="line">    </span><br><span class="line">    @PostMapping(value = &quot;api/brand/create&quot;, produces = MediaType.APPLICATION_JSON_VALUE, consumes = MediaType.APPLICATION_JSON_VALUE)</span><br><span class="line">    ResultDTO create(@RequestBody BrandParam param);</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;api/brand/query&quot;)</span><br><span class="line">    ResultDTO&lt;List&lt;BrandDto&gt;&gt; query(@RequestParam(&quot;id&quot;) Long id, @RequestParam(&quot;code&quot;) String code);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="feign关键组件类"><a href="#feign关键组件类" class="headerlink" title="feign关键组件类"></a>feign关键组件类</h2><p>先列出<code>feign关键</code>的地方，你有个大概印象，进行源码分析时希望你能有意识的<code>重点照顾</code>这些关键点。</p>
<table>
<thead>
<tr>
<th>关键类</th>
<th>作用</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>@EnableFeignClient</td>
<td>声明引入feign组件的标识，同时负责解析@FeignClient</td>
</tr>
<tr>
<td>@FeignClient</td>
<td>声明一个远程调用的接口，供业务方完成远程调用</td>
</tr>
<tr>
<td>FeignClientsRegistrar</td>
<td>加载@FeignClient的所有.class文件，生成beanDefinitioin和beanInstance放入spring容器</td>
</tr>
<tr>
<td>FeignClientFactoryBean</td>
<td>完成feign远程调用所需要组件的聚合，同时还有@FeignClient的代理类的生成</td>
</tr>
<tr>
<td>FeignAutoConfiguration</td>
<td>AutoConfiguration的子类，定义@Bean FeignContext、@Bean xxxHttpClient等</td>
</tr>
<tr>
<td>FeignClientsConfiguration</td>
<td>“Feign configuration”的默认配置值，@EnableFeignClients.defaultConfiguration如果没有设置值，默认就是FeignClientsConfiguration。</td>
</tr>
</tbody>
</table>
<h2 id="feign代码加载原理"><a href="#feign代码加载原理" class="headerlink" title="feign代码加载原理"></a>feign代码加载原理</h2><p>下图是spring boot所有项目加载@Configuration的类时都要走的路径(除了FeignClientsRegistrar)。参见<springboot @configuration类的加载源码和扩展点解析=""></springboot></p>
<p><img src="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191102190916.png" alt="图一"></p>
<h3 id="feign相关组件的-class转化为BeanDefinition"><a href="#feign相关组件的-class转化为BeanDefinition" class="headerlink" title="feign相关组件的.class转化为BeanDefinition"></a>feign相关组件的.class转化为BeanDefinition</h3><p>这个过程可以分成两部分：<code>FeignAutoConfiguration类和FeignClientsConfiguration类</code>等，<code>@EnableFeignClients和@FeignClient</code>。</p>
<p>前者加载过程同spring boot所有组件加载的逻辑，正如图一所示；而后者是采用<code>feign</code>自己的加载方式。当然两者加载过程开始部分是一样的。即从<code>springApplication.run()</code>到<code>ConfigurationClassPostProcessor.processConfigBeanDefinitions()</code>是相同的，也是所有<code>spring boot</code>项目启动加载共用的逻辑。但是从<code>processConfigBeanDefinitions()</code>方法内开始变得不同了。<code>FeignAutoConfiguration类和FeignClientsConfiguration类</code>的加载开始于方法内<code>315行的parser.parse(candidates)</code>,而<code>@EnableFeignClients和@FeignClient</code>的加载开始于<code>327行的this.reader.loadBeanDefinitions(configClasses)</code>。其实，从另一角度可以说<code>FeignAutoConfiguration类和FeignClientsConfiguration</code>类的加载是通用的，<code>@EnableFeignClients和@FeignClient</code>的加载是特殊的，是从通用的某一个点拉出去的分支。所以特殊的是在通用的基础上进行的。从两个不同点进入到各自具体的<code>.class--&gt;BeanDefinition</code>的加载过程。同样的目的，只是使用不同的方式。下面我们详细说下两种加载的源码和原理</p>
<p>》》》值得注意的是，这两种加载方式都是<font color="green">我们实际开发过程中的扩展点：.class转化为beanDefiniton的代码过程</font>。重写他们以完成我们自己实际的逻辑</p>
<h4 id="FeignAutoConfiguration类和FeignClientsConfiguration类等"><a href="#FeignAutoConfiguration类和FeignClientsConfiguration类等" class="headerlink" title="FeignAutoConfiguration类和FeignClientsConfiguration类等"></a>FeignAutoConfiguration类和FeignClientsConfiguration类等</h4><p>前面说到，他们的加载开始于ConfigurationClassPostProcessor.processConfigBeanDefinitions()方法的<code>315行: 的parser.parse(candidates)</code>。我们就从这里说起<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">public void processConfigBeanDefinitions(BeanDefinitionRegistry registry) &#123;</span><br><span class="line">    List&lt;BeanDefinitionHolder&gt; configCandidates = new ArrayList&lt;&gt;();</span><br><span class="line">    String[] candidateNames = registry.getBeanDefinitionNames();</span><br><span class="line">    for (String beanName : candidateNames) &#123;</span><br><span class="line">        BeanDefinition beanDef = registry.getBeanDefinition(beanName);</span><br><span class="line">        // 检查beanDefinition的beanClass是否为标识了@Configuration的class，符合的放入集合</span><br><span class="line">        if (ConfigurationClassUtils.checkConfigurationClassCandidate(beanDef, this.metadataReaderFactory)) &#123;</span><br><span class="line">            configCandidates.add(new BeanDefinitionHolder(beanDef, beanName));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // 根据@Order给集合中的对象排序，也就是对象被加载的顺序</span><br><span class="line">    configCandidates.sort((bd1, bd2) -&gt; &#123;</span><br><span class="line">        int i1 = ConfigurationClassUtils.getOrder(bd1.getBeanDefinition());</span><br><span class="line">        int i2 = ConfigurationClassUtils.getOrder(bd2.getBeanDefinition());</span><br><span class="line">        return Integer.compare(i1, i2);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // Parse each @Configuration class</span><br><span class="line">    ConfigurationClassParser parser = new ConfigurationClassParser(</span><br><span class="line">            this.metadataReaderFactory, this.problemReporter, this.environment,</span><br><span class="line">            this.resourceLoader, this.componentScanBeanNameGenerator, registry);</span><br><span class="line"></span><br><span class="line">    Set&lt;BeanDefinitionHolder&gt; candidates = new LinkedHashSet&lt;&gt;(configCandidates);</span><br><span class="line">    do &#123;`</span><br><span class="line">        // FeignAutoConfiguration类和FeignClientsConfiguration类等通用组件的加载开始处</span><br><span class="line">        // 方法功能为以candidates为起点进行向下加载。一般为项目的启动类，如这里的SkylerApplication</span><br><span class="line">        parser.parse(candidates);</span><br><span class="line">        parser.validate();</span><br><span class="line"></span><br><span class="line">        Set&lt;ConfigurationClass&gt; configClasses = new LinkedHashSet&lt;&gt;(parser.getConfigurationClasses());</span><br><span class="line">        // Read the model and create bean definitions based on its content</span><br><span class="line">        if (this.reader == null) &#123;</span><br><span class="line">            this.reader = new ConfigurationClassBeanDefinitionReader(</span><br><span class="line">                registry, this.sourceExtractor, this.resourceLoader, this.environment,</span><br><span class="line">                this.importBeanNameGenerator, parser.getImportRegistry());</span><br><span class="line">        &#125;</span><br><span class="line">        // @EnableFeignClients和@FeignClient的加载处，当然通用的加载也会走这里</span><br><span class="line">        // 方法功能为解析每个ConfigurationClass，看看有没有@Bean @Import @ImportResource @Scope注解，如果如解析他们形成BeanDefinition，放入beanFactory容器中</span><br><span class="line">        this.reader.loadBeanDefinitions(configClasses);</span><br><span class="line"></span><br><span class="line">        candidates.clear();</span><br><span class="line">        if (registry.getBeanDefinitionCount() &gt; candidateNames.length) &#123;</span><br><span class="line">            String[] newCandidateNames = registry.getBeanDefinitionNames();</span><br><span class="line">            for (String candidateName : newCandidateNames) &#123;</span><br><span class="line">                    BeanDefinition bd = registry.getBeanDefinition(candidateName);</span><br><span class="line">                    if (ConfigurationClassUtils.checkConfigurationClassCandidate(bd, this.metadataReaderFactory)) &#123;</span><br><span class="line">                        candidates.add(new BeanDefinitionHolder(bd, candidateName));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            candidateNames = newCandidateNames;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    while (!candidates.isEmpty());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>详细的加载是始于parser.parse(candidates)行，详细参见todo。到这里，FeignAutoConfiguration类和FeignClientsConfiguration类的加载和解析就完成了。核心是将类中@Bean方法(如feignEncoder()、feignDecoder()、feignBuilder()等)加载成BeanDefinition放入spring beanFactory容器中，为BeanDefinition转化为BeanInstance做准备。@Configuration标识的class由BeanDefinition转化为BeanInstance的详细过程参见todo@Configuration class解析</p>
<h4 id="EnableFeignClients和-FeignClient"><a href="#EnableFeignClients和-FeignClient" class="headerlink" title="@EnableFeignClients和@FeignClient"></a>@EnableFeignClients和@FeignClient</h4><p>这部分的加载是从processConfigBeanDefinitions()方法的<code>327行的this.reader.loadBeanDefinitions(configClasses)</code>开始，再往里说是从此方法内的ConfigurationClassBeanDefinitionReader.loadBeanDefinitionsForConfigurationClass()开始的。也就是开始处理ConfigurationClass对象。当处理到ConfigurationClass(SkylerApplication)时，就会触发@EnableFeignClients的解析了。原理为@EnableFeignClients标注在引入了@SpringBootApplication(内含@Configuration)的SkylerApplication类上,即SkylerApplication类标注了@Configuration注解，所以，SkylerApplication会被解析成ConfigurationClass对象。且@EnableFeignClients内含@Import注解，所以ConfigurationClassPostProcessor解析这个ConfigurationClass(SkylerApplication)对象时，会加载到@EnableFeignClients内嵌注解@Import的FeignClientsRegistrar类。又FeignClientsRegistrar是ImportBeanDefinitionRegistrar子类，所以ConfigurationClassBeanDefinitionReader在解析ImportBeanDefinitionRegistrar类型时，会解析FeignClientsRegistrar对象，即Feign相关组件解析和加载就开始了。</p>
<p>由于FeignClientsRegistrar是ImportBeanDefinitionRegistrar类型，它重载了registerBeanDefinitions()方法来实现解析@FeignClient的功能，这也是FeignClientsRegistrar类的核心作用。如下代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void registerBeanDefinitions(AnnotationMetadata metadata,</span><br><span class="line">        BeanDefinitionRegistry registry) &#123;</span><br><span class="line">    // 解析@EnableFeignClients的defaultConfiguration属性，用于feign的全局设置       </span><br><span class="line">    registerDefaultConfiguration(metadata, registry);</span><br><span class="line">    // 解析@FeignClient注解</span><br><span class="line">    registerFeignClients(metadata, registry);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>方法的入参：metadata是ConfigurationClass的元注解信息，即SkylerApplication类的注解信息；registry是DefaultListableBeanFactory对象引用。解析生成的BeanDefinition都放入spring beanFactory容器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">private void registerDefaultConfiguration(AnnotationMetadata metadata,</span><br><span class="line">        BeanDefinitionRegistry registry) &#123;</span><br><span class="line">    // 获取EnableFeignClients注解的属性及值        </span><br><span class="line">    Map&lt;String, Object&gt; defaultAttrs = metadata</span><br><span class="line">            .getAnnotationAttributes(EnableFeignClients.class.getName(), true);</span><br><span class="line">    // 获取的属性及name存入spring的BeanFactory容器内</span><br><span class="line">    registerClientConfiguration(registry, name,</span><br><span class="line">            defaultAttrs.get(&quot;defaultConfiguration&quot;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><font color="green">这里我们实际开发中的扩展点为:</font>引入@EnableFeignClients时，可以自定义它的defaultConfiguration属性的值，从而实现我们自己关于Feign的配置。如重写Feign请求响应信息的加密解密、fallback、fallbackFactory等</p>
<p>我们重点看registerFeignClients()方法的逻辑：加载标注了@FeignClient的.class文件，解析并获取符合条件的class，生成BeanDefinition，放入spring beanFactory容器。代码如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">public void registerFeignClients(AnnotationMetadata metadata,</span><br><span class="line">        BeanDefinitionRegistry registry) &#123;</span><br><span class="line">    // 实例化对象</span><br><span class="line">    ClassPathScanningCandidateComponentProvider scanner = getScanner();</span><br><span class="line">    scanner.setResourceLoader(this.resourceLoader);</span><br><span class="line"></span><br><span class="line">    Set&lt;String&gt; basePackages;</span><br><span class="line"></span><br><span class="line">    Map&lt;String, Object&gt; attrs = metadata</span><br><span class="line">            .getAnnotationAttributes(EnableFeignClients.class.getName());</span><br><span class="line">    AnnotationTypeFilter annotationTypeFilter = new AnnotationTypeFilter(</span><br><span class="line">            FeignClient.class);</span><br><span class="line">    final Class&lt;?&gt;[] clients = attrs == null ? null</span><br><span class="line">            : (Class&lt;?&gt;[]) attrs.get(&quot;clients&quot;);</span><br><span class="line">    // 确定要搜索的package</span><br><span class="line">    if (clients == null || clients.length == 0) &#123;</span><br><span class="line">        scanner.addIncludeFilter(annotationTypeFilter);</span><br><span class="line">        basePackages = getBasePackages(metadata);</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        final Set&lt;String&gt; clientClasses = new HashSet&lt;&gt;();</span><br><span class="line">        basePackages = new HashSet&lt;&gt;();</span><br><span class="line">        for (Class&lt;?&gt; clazz : clients) &#123;</span><br><span class="line">            basePackages.add(ClassUtils.getPackageName(clazz));</span><br><span class="line">            clientClasses.add(clazz.getCanonicalName());</span><br><span class="line">        &#125;</span><br><span class="line">        AbstractClassTestingTypeFilter filter = new AbstractClassTestingTypeFilter() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            protected boolean match(ClassMetadata metadata) &#123;</span><br><span class="line">                String cleaned = metadata.getClassName().replaceAll(&quot;\\$&quot;, &quot;.&quot;);</span><br><span class="line">                return clientClasses.contains(cleaned);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        scanner.addIncludeFilter(new AllTypeFilter(Arrays.asList(filter, annotationTypeFilter)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 加载package将标注了@FeignClient的.class转化为BeanDefinition，放入spring beanFactory容器</span><br><span class="line">    for (String basePackage : basePackages) &#123;</span><br><span class="line">        Set&lt;BeanDefinition&gt; candidateComponents = scanner.findCandidateComponents(basePackage);</span><br><span class="line"></span><br><span class="line">        for (BeanDefinition candidateComponent : candidateComponents) &#123;</span><br><span class="line">            if (candidateComponent instanceof AnnotatedBeanDefinition) &#123;</span><br><span class="line">                AnnotatedBeanDefinition beanDefinition = (AnnotatedBeanDefinition) candidateComponent;</span><br><span class="line">                AnnotationMetadata annotationMetadata = beanDefinition.getMetadata();</span><br><span class="line">                 </span><br><span class="line">                Map&lt;String, Object&gt; attributes = annotationMetadata</span><br><span class="line">                        .getAnnotationAttributes(FeignClient.class.getCanonicalName());</span><br><span class="line"></span><br><span class="line">                // 获取@FeignClient的configuration属性值，生成BeanDefinition放入spring beanFactory容器</span><br><span class="line">                // 还记得@EnableFeignClient.defaultConfiguration的属性值吗，对比@FeignClient.configuration，所以前者是所有@FeignClient使用，后者是单个@FeignClient使用，后者优先级高于前者</span><br><span class="line">                registerClientConfiguration(registry, getClientName(attributes), attributes.get(&quot;configuration&quot;));</span><br><span class="line">                // 将每个@FeignClient解析，生成BeanDefinition放入spring BeanFactory容器</span><br><span class="line">                registerFeignClient(registry, annotationMetadata, attributes);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>为搜索到符合条件的@FeignClient的类，此方法分两步</p>
<ol>
<li>首先，确定要搜索的package目录</li>
<li>其次，从这些package目录下获取和解析@FeignClient的类</li>
</ol>
<p>方法分三个情况来确定package包目录：优先从@EnableFeignClients.clients获取属性值，从而确定package目录；第二优先级从EnableFeignClients的属性value、basePackages、basePackageClasses获取属性值，从而确定package目录；最后优先级从@EnableFeignClient所在的类的package，从而确定package目录。</p>
<p>确定了package目录后，开始加载package包目录下标注了@FeignClient的.class文件。加载.class文件使用的是ClassPathScanningCandidateComponentProvider类，这个类的resourceLoader变量提供classLoader来加载.class文件；同时includeFilters变量标识要将哪些类转化为BeanDefinition。最后将BeanDefinition放入spring BeanFactory容器。为了尽量不扰乱feign部分，加载.class及转化为BeanDefinition这里不阐述，详细代码见ClassPathScanningCandidateComponentProvider.scanCandidateComponents()方法</p>
<p>特别注意：<font color="green">这里有一个我们实际开发中的扩展点: 加载指定package目录下标注了指定注解的.class文件们转化为BeanDefinitioon放入spring beanFactory容器</font>。具体如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">第一步：</span><br><span class="line">ClassPathScanningCandidateComponentProvider scanner = getScanner();</span><br><span class="line">scanner.setResourceLoader(this.resourceLoader);</span><br><span class="line">AnnotationTypeFilter annotationTypeFilter = new AnnotationTypeFilter(FeignClient.class);</span><br><span class="line">scanner.addIncludeFilter(annotationTypeFilter);</span><br><span class="line">第二步：</span><br><span class="line">Set&lt;BeanDefinition&gt; candidateComponents = scanner.findCandidateComponents(basePackage);</span><br><span class="line">第三步：</span><br><span class="line">BeanDefinitionReaderUtils.registerBeanDefinition(holder, registry); //registry为BeanDefinitionRegistry及子类或DefaultListableBeanFactory</span><br></pre></td></tr></table></figure></p>
<p>经过以上三步，就可以将指定package下的.class文件转化为BeanDefinition，进而放入spring 的BeanFactory容器中。如:你在实际开发中，需要加载com.yourcompany.projectName下的带有@LoginAccess注解的.class文件，直接使用上面的代码，稍加改动就ok了</p>
<p>在将每个@FeignClient转化生成BeanDefinition放入spring BeanFactory容器时，这里注意一点：生成的BeanDefinition的beanClass值为FeignClientFactoryBean类型(FeignClientFactoryBean是FactoryBean的子类，在beanDefinition生成beanInstance时发挥作用)。如下代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">private void registerFeignClient(BeanDefinitionRegistry registry,</span><br><span class="line">		AnnotationMetadata annotationMetadata, Map&lt;String, Object&gt; attributes) &#123;</span><br><span class="line">    String className = annotationMetadata.getClassName();</span><br><span class="line">    BeanDefinitionBuilder definition = BeanDefinitionBuilder.genericBeanDefinition(FeignClientFactoryBean.class);</span><br><span class="line">    ···</span><br><span class="line">    BeanDefinitionHolder holder = new BeanDefinitionHolder(beanDefinition, className,new String[] &#123; alias &#125;);</span><br><span class="line">    BeanDefinitionReaderUtils.registerBeanDefinition(holder, registry);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<p>现在，feign相关组件的.class转化为BeanDefinition了，BeanDefinition都放入了spring beanFactory容器，即DefaultListableBeanFactroy.beanDefinitionMap属性，这一阶段已经完成。我们以一个实例结束这一阶段：BrandFeignClient标注了@FeignClient，所以BrandFeignClient类转化为BeanDefinition时。生成的BeanDefinition的beanClass值为FeignClientFactoryBean.class，同时BeanDefinition的beanName为BrandFeignClient全限定名。beanName存入beanFactory.beanDefinitionNames；同时，beanName为key，BeanDefinition为value的map存入beanFactory.beanDefinitionMap。需要获取BeanDefinition时，beanFactory容器是以beanName为key从beanDefinitionMap属性中取对应的BeanDefinition的。</p>
<h3 id="feign相关组件的BeanDefinition转化为BeanInstance"><a href="#feign相关组件的BeanDefinition转化为BeanInstance" class="headerlink" title="feign相关组件的BeanDefinition转化为BeanInstance"></a>feign相关组件的BeanDefinition转化为BeanInstance</h3><p>如果说AbstractApplicatonContext.invokeBeanFactoryPostProcessors()负责加载.class到BeanDefinition的转化，那么AbstractApplicationContext.registerBeanPostProcessors()就负责BeanDefinition到BeanInstance的转化。这正好印证了我在<a href="https://yaoyuanyy.github.io/2019/03/12/BeanFactoryPostProcessory%E4%B8%8EBeanPostProcessor%E5%8C%BA%E5%88%AB/">BeanFactoryPostProcessory与BeanPostProcessor区别
</a>所阐述的那样。beanDefinition转化为beanInstance是spring boot通用的逻辑。详细参见<a href="https://yaoyuanyy.github.io/2019/04/12/springboot%20beanDefinition%E8%BD%AC%E5%8C%96%E4%B8%BAbeanInstance%E8%BF%87%E7%A8%8B%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E5%92%8C%E6%89%A9%E5%B1%95%E7%82%B9/">springboot beanDefinition转化为beanInstance过程源码分析和扩展点
</a>。大概的逻辑是从beanFactory容器中的beanDefinitionNames和beanDefinitionMap属性中取出BeanDefinition进行实例化，赋属性值等生成BeanDefinition.beanClass对应的beanInstance，然后放入DefaultSingletonBeanRegistry(beanFactory父类).singletonObjects属性中。后面用到的时候根据key从这个属性中获取beanInstance</p>
<p>通过beanDefinition转化为beanInstance是通用逻辑，如下图<br><img src="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191105185059.png" alt="20191105185059.png"><br>图中doCreateBean开始变得不同了，因为在spring中bean有两种类型：FactoryBean和Bean；如果是FactoryBean，会根据beanName从AbstractAutowiredCapableBeanFactory.factoryBeanInstanceCache获取出beanInstance，接着传给populateBean()方法再进行处理？，当然如果没有获取到，同样走Bean类型的逻辑，即如果是Bean，会调用createBeanInstance(beanName，mbd，··)通过解析mbd(BeanDefinition类型)得到beanInstance，然后将beanInstance存入DefaultSingletonBeanRegistry(beanFactory父类).singletonObjects。显然，@FeignClient标识的类的BeanDifinition的beanClass是FactoryBean类型(FeignClientFactoryBean)，所以他走FactoryBean的逻辑。我们直接定位到转化的关键代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">AbstractAutowiredCapableBeanFactory class</span><br><span class="line">@Override</span><br><span class="line">protected Object createBean(String beanName, RootBeanDefinition mbd, @Nullable Object[] args)  &#123;</span><br><span class="line">    Object beanInstance = doCreateBean(beanName, mbd, args); // (1)</span><br><span class="line">    return beanInstance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">protected Object doCreateBean(final String beanName, final RootBeanDefinition mbd, final @Nullable Object[] args)&#123;</span><br><span class="line">    // Instantiate the bean.</span><br><span class="line">    BeanWrapper instanceWrapper = null;</span><br><span class="line">    if (mbd.isSingleton()) &#123;</span><br><span class="line">        instanceWrapper = this.factoryBeanInstanceCache.remove(beanName);</span><br><span class="line">    &#125;</span><br><span class="line">    if (instanceWrapper == null) &#123;</span><br><span class="line">        instanceWrapper = createBeanInstance(beanName, mbd, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">protected BeanWrapper createBeanInstance(String beanName, RootBeanDefinition mbd, @Nullable Object[] args) &#123;</span><br><span class="line">    return instantiateBean(beanName, mbd);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">protected BeanWrapper instantiateBean(final String beanName, final RootBeanDefinition mbd) &#123;</span><br><span class="line">    Object beanInstance = getInstantiationStrategy().instantiate(mbd, beanName, parent);</span><br><span class="line">    BeanWrapper bw = new BeanWrapperImpl(beanInstance);</span><br><span class="line">    initBeanWrapper(bw);</span><br><span class="line">    return bw;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimpleInstantiationStrategy class</span><br><span class="line">public Object instantiate(RootBeanDefinition bd, @Nullable String beanName, BeanFactory owner) &#123;</span><br><span class="line">    final Class&lt;?&gt; clazz = bd.getBeanClass();</span><br><span class="line">    Constructor&lt;?&gt; constructorToUse = clazz.getDeclaredConstructor();</span><br><span class="line">    return BeanUtils.instantiateClass(constructorToUse);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>上面这几个方法展示了beanInstance生成的大概过程。特别注意，这里有<font color="green">我们实际开发中的扩展点:</font> Class<t>类生成T的instance<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">第一步：得到T.class的Class clazz对象 --&gt; clazz=T.class</span><br><span class="line">第二步：获取clazz的构造函数 --&gt; constructorToUse=clazz.getDeclaredConstructor()</span><br><span class="line">第三步：生成instance --&gt; BeanUtils.instantiateClass(constructorToUse)</span><br></pre></td></tr></table></figure></t></p>
<p>现在，BeanDefintion转化成BeanInstance了。如果拿BrandFeignClient来说的话，BeanDefintion(class BrandFeignClient)转化为BrandFeignClient对象了，且BrandFeignClient对象作为value(key为BrandFeignClient全限定名)存入DefaultSingletonBeanRegistry(beanFactory父类).singletonObjects</p>
<h3 id="feign相关组件的BeanInstance转化为proxy代理类"><a href="#feign相关组件的BeanInstance转化为proxy代理类" class="headerlink" title="feign相关组件的BeanInstance转化为proxy代理类"></a>feign相关组件的BeanInstance转化为proxy代理类</h3><p>当引用了@FeignClient的类的类被实例化时，会inject这个@FeignClient的类，这时候会通过代理生成@FeignClient的类的代理类，然后赋值给实例化的类。以我们开篇示例代码来说，当BrandController类实例化时，他的成员变量BrandFeignClient也会被赋值，而这个值是通过上面讲到的beanInstance即FeignClientFactoryBean对象生成proxy代理类，从而实现Controller调用RPC远程接口。我们重点阐述下这个过程，这也是RPC技术的通用实现方式</p>
<p>先说下如何获取到FeignClientFactoryBean对象的，代码如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">AbstractBeanFactory class</span><br><span class="line">protected &lt;T&gt; T doGetBean(final String beanName) throws BeansException &#123;</span><br><span class="line">    Object sharedInstance = getSingleton(beanName);</span><br><span class="line">    Object bean = getObjectForBeanInstance(sharedInstance, name, beanName, null);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DefaultSingletonBeanRegistry class</span><br><span class="line">protected Object getSingleton(String beanName, boolean allowEarlyReference) &#123;</span><br><span class="line">    Object singletonObject = this.singletonObjects.get(beanName);</span><br><span class="line">	return singletonObject;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">FactoryBeanRegistrySupport class</span><br><span class="line">protected Object getObjectFromFactoryBean(FactoryBean&lt;?&gt; factory, String beanName, boolean shouldPostProcess) &#123;</span><br><span class="line">    object = doGetObjectFromFactoryBean(factory, beanName);</span><br><span class="line">	return object;</span><br><span class="line">&#125;</span><br><span class="line">private Object doGetObjectFromFactoryBean(final FactoryBean&lt;?&gt; factory, final String beanName) &#123;</span><br><span class="line">    object = factory.getObject();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">FeignClientFactoryBean class</span><br><span class="line">@Override</span><br><span class="line">public Object getObject() throws Exception &#123;</span><br><span class="line">    return getTarget();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">FeignClientFactoryBean class</span><br><span class="line">&lt;T&gt; T getTarget() &#123;</span><br><span class="line">    FeignContext context = this.applicationContext.getBean(FeignContext.class); //(1)</span><br><span class="line">    Feign.Builder builder = feign(context); //(2)</span><br><span class="line"></span><br><span class="line">    if (!StringUtils.hasText(this.url)) &#123;</span><br><span class="line">        if (!this.name.startsWith(&quot;http&quot;)) &#123;</span><br><span class="line">            this.url = &quot;http://&quot; + this.name;</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            this.url = this.name;</span><br><span class="line">        &#125;</span><br><span class="line">        this.url += cleanPath();</span><br><span class="line">        return (T) loadBalance(builder, context,</span><br><span class="line">                new HardCodedTarget&lt;&gt;(this.type, this.name, this.url));</span><br><span class="line">    &#125;</span><br><span class="line">    if (StringUtils.hasText(this.url) &amp;&amp; !this.url.startsWith(&quot;http&quot;)) &#123;</span><br><span class="line">        this.url = &quot;http://&quot; + this.url;</span><br><span class="line">    &#125;</span><br><span class="line">    String url = this.url + cleanPath();</span><br><span class="line">    Client client = getOptional(context, Client.class);</span><br><span class="line">    if (client != null) &#123;</span><br><span class="line">        if (client instanceof LoadBalancerFeignClient) &#123;</span><br><span class="line">            // not load balancing because we have a url,</span><br><span class="line">            // but ribbon is on the classpath, so unwrap</span><br><span class="line">            client = ((LoadBalancerFeignClient) client).getDelegate();</span><br><span class="line">        &#125;</span><br><span class="line">        builder.client(client);</span><br><span class="line">    &#125;</span><br><span class="line">    Targeter targeter = get(context, Targeter.class); //(3)</span><br><span class="line">    return (T) targeter.target(this, builder, context,</span><br><span class="line">            new HardCodedTarget&lt;&gt;(this.type, this.name, url)); //(4)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>进到FeignClientFactoryBean.getObject()方法，关于@FeignClient类生成proxy代理类的过程就在这个方法中。这个逻辑分为四步：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 获取FeignContext对象</span><br><span class="line">2. 获取Feign.Builder对象</span><br><span class="line">3. 获取Targeter对象</span><br><span class="line">4. 调用Targeter.targeter()生成proxy代理类</span><br></pre></td></tr></table></figure></p>
<p>特别说一下，在步骤2后有个挺关键的逻辑点：会以url为分线，如果没有url就会走负载均衡，反之没有。分线的意义价值在于我们可以以两种方式使用feign远程调用，一是通过url属性值直接通过<code>域名调用</code>http接口；二是通过Eureka走负载均衡调用http接口。通过url的方式可以实现快速调用，不需要依赖eureka等服务，可以直接打到目标机器，特别适合用在快速迭代场景；而负载均衡方式扩展性好，适合线上环境。</p>
<p>针对@FeignClient类生成proxy代理类的步骤，我们每个步骤都详细阐述，如下</p>
<h4 id="FeignClient类生成proxy代理类"><a href="#FeignClient类生成proxy代理类" class="headerlink" title="@FeignClient类生成proxy代理类"></a>@FeignClient类生成proxy代理类</h4><h5 id="获取FeignContext对象"><a href="#获取FeignContext对象" class="headerlink" title="获取FeignContext对象"></a>获取FeignContext对象</h5><p>FeignClientFactoryBean.getTarget()方法(1)处所示，FeignContext对象是从beanFactory中获取的。又如下代码：FeignContext是以@Bean方法的方式声明的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class FeignAutoConfiguration &#123;</span><br><span class="line">	@Bean</span><br><span class="line">	public FeignContext feignContext() &#123;</span><br><span class="line">		FeignContext context = new FeignContext();</span><br><span class="line">		context.setConfigurations(this.configurations);</span><br><span class="line">		return context;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>关于FeignContext对象的生成过程，参见<springboot @configuration类的加载源码和扩展点解析="">。FeignContext对象包含了<br><img src="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191106171742.png" alt="20191106171742.png"><br>图中configurations属性存储了所有的@FeignClient的类即FeignClientSpecification，用于</springboot></p>
<h5 id="获取Feign-Builder对象"><a href="#获取Feign-Builder对象" class="headerlink" title="获取Feign.Builder对象"></a>获取Feign.Builder对象</h5><p>FeignClientFactoryBean.getTarget()方法(2)处通过调用feign()方法获取Feign.Builder对象，代码如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">protected Feign.Builder feign(FeignContext context) &#123;</span><br><span class="line">    FeignLoggerFactory loggerFactory = get(context, FeignLoggerFactory.class);</span><br><span class="line">    Logger logger = loggerFactory.create(this.type);</span><br><span class="line"></span><br><span class="line">    Feign.Builder builder = get(context, Feign.Builder.class)</span><br><span class="line">            // required values</span><br><span class="line">            .logger(logger)</span><br><span class="line">            .encoder(get(context, Encoder.class))</span><br><span class="line">            .decoder(get(context, Decoder.class))</span><br><span class="line">            .contract(get(context, Contract.class));</span><br><span class="line"></span><br><span class="line">    configureFeign(context, builder);</span><br><span class="line"></span><br><span class="line">    return builder;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">protected void configureFeign(FeignContext context, Feign.Builder builder) &#123;</span><br><span class="line">    FeignClientProperties properties = this.applicationContext</span><br><span class="line">            .getBean(FeignClientProperties.class);</span><br><span class="line">    if (properties != null) &#123;</span><br><span class="line">        if (properties.isDefaultToProperties()) &#123;</span><br><span class="line">            configureUsingConfiguration(context, builder);</span><br><span class="line">            configureUsingProperties(</span><br><span class="line">                    properties.getConfig().get(properties.getDefaultConfig()),</span><br><span class="line">                    builder);</span><br><span class="line">            configureUsingProperties(properties.getConfig().get(this.contextId),</span><br><span class="line">                    builder);</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            configureUsingProperties(</span><br><span class="line">                    properties.getConfig().get(properties.getDefaultConfig()),</span><br><span class="line">                    builder);</span><br><span class="line">            configureUsingProperties(properties.getConfig().get(this.contextId),</span><br><span class="line">                    builder);</span><br><span class="line">            configureUsingConfiguration(context, builder);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        configureUsingConfiguration(context, builder);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如上代码，通过给Feign.Builder对象的各属性赋值从而构建对象，这些属性包括requestInterceptors、logLevel、contract、client、encoder、decoder、queryMapEncoder、options等，Feign.Builder对象负责生成@FeignClient类的proxy代理类，所以这些属性在生成proxy代理时都会用到。configureFeign()方法说明一个逻辑：有两种方式配置@FeignClient的属性值，1是properties.yml文件配置，二是使用@Configuration结合@Bean的方式。并且默认前者方式覆盖后者方式，但是可以通过配置feign.client.defaultToProperties属性值实现倒转覆盖</p>
<h5 id="获取Targeter对象"><a href="#获取Targeter对象" class="headerlink" title="获取Targeter对象"></a>获取Targeter对象</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@ConditionalOnClass(name = &quot;feign.hystrix.HystrixFeign&quot;)</span><br><span class="line">protected static class HystrixFeignTargeterConfiguration &#123;</span><br><span class="line">    @Bean</span><br><span class="line">    @ConditionalOnMissingBean</span><br><span class="line">    public Targeter feignTargeter() &#123;</span><br><span class="line">        return new HystrixTargeter();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Targeter对象的生成同FeignContext对象的生成过程，参见<springboot @configuration类的加载源码和扩展点解析="">。这个对象的作用是判断是否配置Hystrix熔断fallback。</springboot></p>
<h5 id="调用Targeter-targeter-生成proxy代理类"><a href="#调用Targeter-targeter-生成proxy代理类" class="headerlink" title="调用Targeter.targeter()生成proxy代理类"></a>调用Targeter.targeter()生成proxy代理类</h5><p>FeignClientFactoryBean.getTarget()方法(4)处生成proxy代理类。代码如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">HystrixTargeter class</span><br><span class="line">public &lt;T&gt; T target(FeignClientFactoryBean factory, Feign.Builder feign,</span><br><span class="line">        FeignContext context, Target.HardCodedTarget&lt;T&gt; target) &#123;</span><br><span class="line">    if (!(feign instanceof feign.hystrix.HystrixFeign.Builder)) &#123;</span><br><span class="line">        return feign.target(target);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Feign.Builder class</span><br><span class="line">public &lt;T&gt; T target(Target&lt;T&gt; target) &#123;</span><br><span class="line">    return build().newInstance(target);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">public Feign build() &#123;</span><br><span class="line">    SynchronousMethodHandler.Factory synchronousMethodHandlerFactory =</span><br><span class="line">        new SynchronousMethodHandler.Factory(client, retryer, requestInterceptors, logger,</span><br><span class="line">            logLevel, decode404, closeAfterDecode, propagationPolicy);</span><br><span class="line">    ParseHandlersByName handlersByName =</span><br><span class="line">        new ParseHandlersByName(contract, options, encoder, decoder, queryMapEncoder,</span><br><span class="line">            errorDecoder, synchronousMethodHandlerFactory);</span><br><span class="line">    return new ReflectiveFeign(handlersByName, invocationHandlerFactory, queryMapEncoder);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReflectiveFeign class</span><br><span class="line">public &lt;T&gt; T newInstance(Target&lt;T&gt; target) &#123;</span><br><span class="line">    Map&lt;String, MethodHandler&gt; nameToHandler = targetToHandlersByName.apply(target);</span><br><span class="line">    Map&lt;Method, MethodHandler&gt; methodToHandler = new LinkedHashMap&lt;Method, MethodHandler&gt;();</span><br><span class="line">    List&lt;DefaultMethodHandler&gt; defaultMethodHandlers = new LinkedList&lt;DefaultMethodHandler&gt;();</span><br><span class="line"></span><br><span class="line">    for (Method method : target.type().getMethods()) &#123;</span><br><span class="line">      if (method.getDeclaringClass() == Object.class) &#123;</span><br><span class="line">        continue;</span><br><span class="line">      &#125; else if (Util.isDefault(method)) &#123;</span><br><span class="line">        DefaultMethodHandler handler = new DefaultMethodHandler(method);</span><br><span class="line">        defaultMethodHandlers.add(handler);</span><br><span class="line">        methodToHandler.put(method, handler);</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        methodToHandler.put(method, nameToHandler.get(Feign.configKey(target.type(), method)));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    InvocationHandler handler = factory.create(target, methodToHandler);</span><br><span class="line">    T proxy = (T) Proxy.newProxyInstance(target.type().getClassLoader(),</span><br><span class="line">        new Class&lt;?&gt;[] &#123;target.type()&#125;, handler);</span><br><span class="line"></span><br><span class="line">    for (DefaultMethodHandler defaultMethodHandler : defaultMethodHandlers) &#123;</span><br><span class="line">      defaultMethodHandler.bindTo(proxy);</span><br><span class="line">    &#125;</span><br><span class="line">    return proxy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>到这里，终于看到proxy的生成了。ReflectiveFeign直接负责proxy代理类的生成。从newInstance()可以看出，代理生成使用的是jdk动态代理。这个过程中，有两个类特别重要: FeignInvocationHandler和SynchronousMethodHandler。SynchronousMethodHandler是MethodHandler的子类，从名字可以看出作用，方法method对应的处理器handler，她存储的是标识了@FeignClient的类中对每个方法解析结果的存储，如图所示：<br><img src="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191107074325.png" alt="20191107074325.png"></p>
<p>FeignInvocationHandler是jdk InvocationHandler的子类，即通过它调用proxy代理类；FeignInvocationHandler类的创建采用工厂方法的形式，值得我们学习。生成代理类时，FeignInvocationHandler包裹着SynchronousMethodHandler集合传入到代理类中。生成的proxy代理类如图所示。<br><img src="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191107080016.png" alt="20191107080016.png"></p>
<p>BeanPostProcessors()) {<br>            Object current = processor.postProcessAfterInitialization</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">AutowiredAnnotitionBeanPostProcessor class</span><br><span class="line">protected void inject(Object bean, @Nullable String beanName, @Nullable PropertyValues pvs) &#123;</span><br><span class="line">    // 赋权限filed可见性，防止filed是private时导致赋值报错</span><br><span class="line">    ReflectionUtils.makeAccessible(field);</span><br><span class="line">    // 反射给属性赋值</span><br><span class="line">    field.set(bean, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>各属性值如下图所示<br>filed:<br><img src="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191107081652.png" alt="20191107081652.png"><br>bean:<br><img src="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191107081722.png" alt="20191107081722.png"><br>value:<br><img src="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191107081510.png" alt="20191107081510.png"><br>从而此时BrandController.brandFeignClient属性赋值完成。即BrandController.brandFeignClient=$Proxy105，从而当有http请求进入Controller方法时，即调用brandFeignClient的方法，从而进入代理类逻辑中。</p>
<h2 id="请求处理分析"><a href="#请求处理分析" class="headerlink" title="请求处理分析"></a>请求处理分析</h2><p>Feign组件已经实例化完成，同时BrandController.brandFeignClient已经被赋值完成。现在就可以应用了，当一个http请求进来时，它的逻辑也就开始了</p>
<p>发送请求：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &apos;http://127.0.0.1:6003/brand/query?id=1&amp;code=2&apos;</span><br></pre></td></tr></table></figure></p>
<p>对应的处理请求方法：<br><img src="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/!%5B20191107084916.png%5D(httpsraw.githubusercontent.comyaoyuanyyMarkdownPhotosmasterimg20191107084916.png" alt="20191107085101.png">)</p>
<p>可以看到，此时的brandFeignClient值时$Proxy105，即如下图所示，方法直接进入了FeignInvocationHandler.invoke方法(此处如有疑问，请看$proxy105的.class文件)。<br><img src="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191107085102.png" alt="20191107085102.png"></p>
<p>这里是我们着重说的地方，这里的逻辑是通用的，每个Feign的代理类都走这个逻辑。<br>还记得FeignInvocationHandler这个类吧，生成proxy代理类小节我们重点说过，那个时候它被实例化，现在开始使用实例化时的属性值。看代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FeignInvocationHandler class</span><br><span class="line">public Object invoke(Object proxy, Method method, Object[] args) &#123;</span><br><span class="line">    return dispatch.get(method).invoke(args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>dispatch:Map&lt;Method, MethodHandler&gt;类型，value为SynchronousMethodHandler,SynchronousMethodHandler存储这每个方法的信息。dispatch如下图<br><img src="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191107090336.png" alt="20191107090336.png"></p>
<p>看代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SynchronousMethodHandler class</span><br><span class="line">public Object invoke(Object[] argv) throws Throwable &#123;</span><br><span class="line">    // 将BrandFeignClient.query()方法转化为包含http请求信息RequestTemplate对象，如下图</span><br><span class="line">    RequestTemplate template = buildTemplateFromArgs.create(argv);</span><br><span class="line">    Retryer retryer = this.retryer.clone();</span><br><span class="line">    while (true) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            return executeAndDecode(template);</span><br><span class="line">        &#125; catch (RetryableException e) &#123;</span><br><span class="line">           // 重试逻辑</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>方法分两步<br>第一步：<br>将@FeignClient类的方法转化为包含http请求信息RequestTemplate对象，如图<br><img src="https://raw.githubusercontent.com/yaoyuanyy/MarkdownPhotos/master/img/20191108073006.png" alt="20191108073006.png"></p>
<p>第二步：组装并发送request请求，处理response响应数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  Object executeAndDecode(RequestTemplate template) throws Throwable &#123;</span><br><span class="line">    // 组装成request请求，</span><br><span class="line">    Request request = targetRequest(template);</span><br><span class="line"></span><br><span class="line">    if (logLevel != Logger.Level.NONE) &#123;</span><br><span class="line">      logger.logRequest(metadata.configKey(), logLevel, request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Response response = client.execute(request, options);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>方法首先会组装成request请求，会经过RequestInterceptor拦截处理，这就给了我们扩展的机会。这里我们实际开发中可以继承RequestInterceptor实现我们的逻辑，如处理Get方式的request body数据。然后是根据日志级别记录日志，这里给我的启示为，我们平时开发中记录日志可以向这样封装处理。</p>
<p>最后是使用LoadBalanceFeignClient(这是feign默认使用的FeignClient)，他结合ribbon和eureka实现负载均衡，根据ribbon的算法找到一台远程服务，最后是发送请求，得到响应数据。ribbon负载均衡详见网上文档</p>
<p>到这里，整个feign组件的加载解析，以及请求处理都完事了，花了3天时间，难免有疏漏</p>
<h3 id="标注了-FeignClient的类实例化过程总结"><a href="#标注了-FeignClient的类实例化过程总结" class="headerlink" title="标注了@FeignClient的类实例化过程总结"></a>标注了@FeignClient的类实例化过程总结</h3><p>一个java .class文件在spring boot中的转化过程<br>.class–&gt;BeanDefinition–&gt;beanInstance–&gt;proxy代理类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">beanDefinition在beanFactory的存储位置：</span><br><span class="line">DefaultListableBeanFactroy.beanDenifitionNames.add(beanName);</span><br><span class="line">DefaultListableBeanFactroy.beanDenifitionMap.put(beanName, BeanDefinition);</span><br><span class="line">beanName:com.ke.utopia.construction.api.ConstructionStoppageFeignService</span><br><span class="line">BeanDefinition:GenericBeanDefinition(beanClass=class org.springframework.cloud.openfeign.FeignClientFactoryBean))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">beanInstance在beanFactory的存储位置：</span><br><span class="line">DefaultSingletonBeanRegistry.singletonObjects.put(beanName, beanInstance);</span><br><span class="line">beanName:com.ke.utopia.construction.api.ConstructionStoppageFeignService</span><br><span class="line">beanInstance:FeignClientFactoryBean(type=interface com.ke.utopia.construction.api.ConstructionStoppageFeignService)</span><br><span class="line"></span><br><span class="line">proxy代理类在beanFactory的存储位置：</span><br><span class="line">不会放入beanFactory，而是直接赋值给引用它的属性</span><br></pre></td></tr></table></figure>
<p>关于feign的使用参见<br><a href="https://segmentfault.com/a/1190000020656405" target="_blank" rel="noopener">https://segmentfault.com/a/1190000020656405</a><br><a href="https://juejin.im/post/5c6fb8b7518825629b42f572" target="_blank" rel="noopener">https://juejin.im/post/5c6fb8b7518825629b42f572</a></p>
<p>随时小问</p>
<ol>
<li>feign是如何支持图片等流数据的</li>
<li>feign的encoder和decoder原理</li>
<li>feign的constract作用</li>
<li>feign方法入参为什么必须加上注解</li>
<li>feign GET请求入参不支持对象方式接收</li>
</ol>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="https://yaoyuanyy.github.io/2019/10/23/springcloud feign扩展点及原理(源码)分析/" title="spring cloud feign扩展点及原理(源码)分析" target="_blank" rel="external">https://yaoyuanyy.github.io/2019/10/23/springcloud feign扩展点及原理(源码)分析/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/yaoyuanyy" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/meinv.jpeg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/yaoyuanyy" target="_blank"><span class="text-dark">skyler</span><small class="ml-1x">Web Developer</small></a></h3>
        <div>java后端开发，to B业务，趋于蓝色的性格，喜欢篮球等</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom="">
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2019/11/09/spring boot加载.class方式草集/" title="spring boot加载.class方式草集"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2019/10/23/服务可用性的思考/" title="服务可用性的思考"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>感谢您的支持，我会继续努力的!</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫">
              </div>
              <p class="text-muted mv">扫码打赏，你说多少就多少</p>
              <p class="text-grey">打开支付宝扫一扫，即可进行扫码打赏哦</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/wechat_pay.png" alt="扫码支持" title="扫一扫">
              </div>
              <p class="text-muted mv">扫码打赏，你说多少就多少</p>
              <p class="text-grey">打开微信扫一扫，即可进行扫码打赏哦</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



</main>

  <footer class="footer" itemscope="" itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/yaoyuanyy" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li>
        
        <li><a href="https://juejin.cn/user/729731449759047/posts" target="_blank" title="Juejin" data-toggle="tooltip" data-placement="top"><i class="icon icon-juejin"></i></a></li>
        
        <li><a href="https://blog.csdn.net/mingliangniwo" target="_blank" title="Csdn" data-toggle="tooltip" data-placement="top"><i class="icon icon-csdn"></i></a></li>
        
        <li><a href="https://yaoyuanyy.github.io" target="_blank" title="Github Pages" data-toggle="tooltip" data-placement="top"><i class="icon icon-github pages"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>
<script src="/js/plugin.min.js"></script>
<script src="/js/application.js"></script>

    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>





   
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





   
    
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#vcomments',
    verify: false,
    notify: false,
    appId: 'FA5MfMbhgGSiEPOyVmYfHbR6-gzGzoHsz',
    appKey: '2aAdTrUVOhFxm0uqpBFC1dhv',
    placeholder: 'tell anything',
    avatar: '',
    meta: meta,
    pageSize: '10' || 10,
    visitor: false
  });
  </script>

     





    <!-- <script defer type="text/javascript">
(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'G-WR4XDKYXVY', 'auto');
ga('send', 'pageview');

</script> -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WR4XDKYXVY"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-WR4XDKYXVY');
</script>



</body>
</html>